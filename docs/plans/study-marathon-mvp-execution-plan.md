# Study Marathon (MVP版) 実行計画書

本ドキュメントは、要件定義書「docs/要件定義MVP.md」に基づき、MVP版 Study Marathon の開発を Phase ごとに段階的に進めるための実行計画です。
各Phaseの終端では、必ず「画面上での確認ポイント(UI確認ポイント)」を定義し、レビューしやすい状態を作ります。

---

## Phase 0: 開発環境・プロジェクト初期セットアップ

- **現在の状況**
　- もうすでに依存関係等を準備できている状態で、localhost;8080でアクセスを確認済みとなっている（Spring securityが有効になっているので/にアクセスすると/loginにリダイレクトされる状態）

- **目的**

  - Spring Boot + H2 を利用した最小構成のプロジェクトを起動できる状態にする。
  - 今後の画面開発のためのテンプレートエンジン(例: Thymeleaf)の土台を用意する。

- **スコープ**
  - アプリ起動確認用の簡易 Controller + View

- **主なタスク**
  - プロジェクト雛形作成と起動確認
    - 0-1. 既存リポジトリの最新を取得 (`main` ブランチを前提)
    - 0-2. `mvnw spring-boot:run` でアプリが起動することを確認
    - 0-3. ブラウザから `http://localhost:8080` にアクセスし、`/login` にリダイレクトされることを確認
  - 設定ファイルの初期設定
    - 1-1. `src/main/resources/application.yml` (または `application.properties`) を作成/整理
    - 1-2. ポート番号、H2、Thymeleaf などの基本設定を記載
    - 1-3. ログレベル(開発用)の設定を追加するか検討
  - H2 Console 有効化(必要に応じて)
    - 2-1. H2 Console を有効化する設定を追加
    - 2-2. セキュリティ設定で H2 Console へのアクセス方法を検討 (開発環境のみ許可など)
    - 2-3. 起動後に `http://localhost:8080/h2-console` へアクセスし、画面表示を確認
  - トップページ(仮)のルーティングと簡易テンプレート
    - 3-1. 仮トップページ用の Controller クラスを作成 (例: `HomeController`)
    - 3-2. ルーティング `/` を定義し、仮のView(Thymeleaf)を返すように実装
    - 3-3. `templates` 配下に `index.html` などの仮テンプレートを作成し、「Study Marathon MVP (仮)」などの文言を表示
    - 3-4. Spring Security 設定の都合上、`/` へのアクセス時の挙動(ログイン要/不要)を一度整理し、今回はどう扱うかメモを残す
  - 動作確認・記録
    - 4-1. 上記変更を反映後、再度 `mvnw spring-boot:run` で起動し、ブラウザから `/` および `/login` へアクセスして画面表示を確認
    - 4-2. 確認できた画面キャプチャを1〜2枚取得し、後続Phaseのレビューで参照できるように保存 (保存場所は別途決定)

- **UI確認ポイント**
  - ブラウザで `http://localhost:xxxx/` にアクセスすると「Study Marathon MVP (仮)」などのシンプルな画面が表示される。

---

## Phase 1: DB接続とEntity定義 (Hello World & DB接続)

- **目的**
  - 要件定義書の「Users」「Study_Logs」2テーブルに対応するEntityとマイグレーション設定を行い、DBとの接続を確認する。

- **スコープ**
  - `Users` / `StudyLogs` Entity 作成
  - Repository インターフェース作成
  - 簡易データ登録・取得の疎通確認

- **主なタスク**
  - `Users` Entity: `id`, `username`, `password`
  - `StudyLogs` Entity: `id`, `user`, `studyDate`, `duration`, `content`
  - JPA リレーション設定 (Users - StudyLogs)
  - CommandLineRunner などでテストデータ投入 & 取得ログ出力

- **UI確認ポイント**
  - テスト用 Controller/画面 or REST エンドポイントから、DBのデータ一覧が確認できる。
  - 画面が難しければ、H2 Console で2テーブルが生成されていることを確認する。

---

## Phase 2: 学習記録 CRUD (ログイン前提なし・自分用の簡易CRUD)

- **目的**
  - 「学習時間の記録」「自分の記録一覧」の基本的な CRUD をログインなしで先に完成させ、画面の流れとバリデーションを固める。

- **スコープ**
  - 学習記録の登録フォーム
  - 学習記録の一覧表示 (全件 or 上位N件)
  - 削除機能 (この時点ではユーザー紐付けは仮 or 固定ユーザー)

- **主なタスク**
  - Controller / Service / Repository 層の実装
  - Thymeleaf 等でのフォーム画面・一覧画面作成
  - 入力バリデーション(分数が0以下でないか等)

- **UI確認ポイント**
  - ブラウザからフォームに「日付」「分数」「内容」を入力し、登録ボタンで即座に下部の一覧に反映される。
  - 一覧から削除ボタンを押すと、その行の記録が削除される。

---

## Phase 3: ユーザー管理 & ログイン (Spring Security導入)

- **目的**
  - 要件定義の「U-01 新規登録」「U-02 ログイン」を実装し、学習記録とユーザーを紐付けられる状態にする。

- **スコープ**
  - ユーザー登録画面
  - ログイン画面
  - Spring Security 設定
  - パスワードのハッシュ化(BCrypt)

- **主なタスク**
  - `UserDetails` / `UserDetailsService` 実装
  - セキュリティ設定クラス作成 (認可ルール、ログインページ、ログアウト設定)
  - 「ログイン/新規登録」タブ切り替え画面の作成
  - 新規登録時に `Users` テーブルへ保存

- **UI確認ポイント**
  - `/login` 画面で「ログイン」「新規登録」タブを切り替え可能。
  - 新規ユーザー登録 → そのユーザーでログインできる。
  - ログイン後のみ学習記録の画面にアクセスできる。

---

## Phase 4: 学習記録機能のユーザー紐付け & マイページ(記録一覧画面)

- **目的**
  - ログインユーザーごとに学習記録を保持し、要件定義の「S-02 自分の記録一覧」を完成させる。

- **スコープ**
  - ログインユーザーに紐づいた記録登録
  - ログインユーザーの記録のみを表示する一覧画面
  - 記録削除機能(自分の記録のみ)

- **主なタスク**
  - ログインユーザー情報の取得 (SecurityContext)
  - `StudyLogs` 登録時に `user_id` を自動紐付け
  - 記録一覧画面(マイページ)の作成

- **UI確認ポイント**
  - ユーザーAでログインして登録した記録は、ユーザーBでログインしても見えない。
  - マイページ(記録一覧画面)で、自分のログの一覧と削除ボタンのみが表示される。

---

## Phase 5: ホーム画面(ダッシュボード) & 今週の学習合計

- **目的**
  - 要件定義の「ホーム画面(ダッシュボード)」「自分の週間合計表示」を実現する。

- **スコープ**
  - ダッシュボード画面(ログイン後のメイン画面)
  - 今週の自分の学習時間合計の計算・表示
  - 学習記録入力フォームの配置

- **主なタスク**
  - 「今週の月曜 0:00 ～ 現在」までの範囲で、ログインユーザーの `duration` 合計を計算するサービス実装
  - ダッシュボードに上部: 今週合計、中部: 入力フォーム、下部: 週間ランキング(後で実装)の枠を用意
  - 入力フォーム送信後に同画面へリダイレクトし、合計・一覧が更新されるようにする

- **UI確認ポイント**
  - ログイン後に表示されるホーム画面上部に「今週の学習時間：XX時間YY分」と表示される。
  - その画面のフォームから記録を登録すると、今週の合計時間が更新される。

---

## Phase 6: 週間ランキング(自動集計)の実装

- **目的**
  - 要件定義の「R-01 週間ランキング」「週間ランキングTOP10」を実装し、MVPのコア価値である「競争」を実現する。

- **スコープ**
  - 今週の全ユーザーの学習時間合計の集計
  - 合計時間の降順でTOP10を表示
  - アクセス時にSQL/JPQLでリアルタイム集計(バッチ処理なし)

- **主なタスク**
  - 期間条件付き集計クエリ(Repository, JPQL/Native SQL)
  - ランキングDTO or Projection の定義 (username, totalDuration)
  - ダッシュボード下部にランキングテーブルを表示

- **UI確認ポイント**
  - ホーム画面下部に「週間ランキングTOP10」が表示される。
  - 複数ユーザーで記録を登録すると、順位と合計時間が変化することが確認できる。

---

## Phase 7: リファクタリング・エラーハンドリング・最終確認

- **目的**
  - コードの整理と基本的なエラー対応を行い、MVPとして安定して動作する状態に仕上げる。

- **スコープ**
  - コード整理(パッケージ構成、共通処理抽出)
  - 簡易的なバリデーションメッセージ/エラーページ
  - 最低限の手動テスト項目確認

- **主なタスク**
  - Controller/Service/Repository の責務見直し
  - フォーム入力エラー時のメッセージ表示
  - ログイン失敗時のメッセージ表示
  - 手動テストシナリオ作成・実行

- **UI確認ポイント**
  - 主要なフロー(ユーザー登録→ログイン→学習記録登録→今週合計→ランキング表示)がエラーなく一通り操作できる。
  - 入力ミス時にわかりやすいエラーメッセージが表示される。
