# 要件定義書：学習時間競争アプリ「Study Marathon (仮)」

## 1. プロジェクト概要
### 1.1 背景・目的
「質より量」をテーマに、学習時間を可視化し、他者と競争することでモチベーションを維持・向上させるWebアプリケーションを作成する。
ユーザーは1週間の学習時間を記録し、その合計時間でランキングを競う。順位に応じてポイントが付与され、ゲーム感覚で学習継続を促す。

### 1.2 ターゲットユーザー
- 学習習慣を身につけたいエンジニアや学生
- 自分の努力量を可視化したいユーザー

## 2. システム要件
### 2.1 使用技術スタック（想定）
- **言語:** Java (17 or 21)
- **フレームワーク:** Spring Boot 3.x
- **テンプレートエンジン:** Thymeleaf (または REST API + フロントエンドFW)
- **データベース:** H2 Database (開発用) / MySQL or PostgreSQL (本番用)
- **セキュリティ:** Spring Security
- **永続化:** Spring Data JPA

## 3. 機能要件

### 3.1 ユーザー管理機能 (認証・認可)
| 機能ID | 機能名 | 概要 | 備考 |
| :--- | :--- | :--- | :--- |
| U-01 | ユーザー登録 | ユーザー名、メールアドレス、パスワードでアカウントを作成する。 | パスワードはハッシュ化して保存 (BCrypt) |
| U-02 | ログイン | 登録情報を元に認証を行い、システムへのアクセスを許可する。 | Spring Securityを使用 |
| U-03 | ログアウト | セッションを破棄し、ログイン画面へ遷移する。 | |

### 3.2 学習記録機能
| 機能ID | 機能名 | 概要 | 備考 |
| :--- | :--- | :--- | :--- |
| S-01 | 学習時間入力 | 日付、学習内容（科目）、学習時間（分）を入力して保存する。 | 1回の学習ごとに登録する形式 |
| S-02 | 週間合計表示 | ログインユーザーの「今週（月曜〜日曜）」の合計学習時間をトップ画面に表示する。 | 毎週月曜0:00に集計対象期間が切り替わる |
| S-03 | 履歴確認 | 過去に入力した学習記録の一覧を表示する。 | |

### 3.3 ランキング・ポイント機能
| 機能ID | 機能名 | 概要 | 備考 |
| :--- | :--- | :--- | :--- |
| R-01 | 週間ランキング | 全ユーザーの「今週の合計学習時間」を集計し、降順でランキング表示する。 | リアルタイムまたは一定間隔で更新 |
| R-02 | ポイント付与 | 毎週日曜23:59（または月曜0:00）の締め切り時点で順位を確定し、順位に応じたポイントをユーザーに付与する。 | `@Scheduled` によるバッチ処理を想定 |
| R-03 | 所持ポイント表示 | ユーザーが現在保有している累計ポイントを表示する。 | |

**※ポイント付与ルールの例:**
- 1位: 100pt
- 2位: 50pt
- 3位: 30pt
- 参加賞（記録あり）: 10pt

## 4. 画面遷移・UI構成案

### 4.1 画面リスト
1. **ログイン / 新規登録画面**
2. **ダッシュボード（トップ画面）**
   - 今週の自分の合計時間
   - 今週のランキングボード（Top 10）
   - 今日の学習入力フォーム（簡易版）
3. **学習記録一覧画面**
   - 過去の履歴リスト
   - 編集・削除機能

## 5. データベース設計 (概念モデル)

シンプルな3テーブル構成とします。

### 5.1 Users (ユーザーテーブル)
| カラム名 | データ型 | 制約 | 説明 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PK, Auto Inc | ユーザーID |
| username | VARCHAR | Not Null | 表示名 |
| email | VARCHAR | Unique | メールアドレス（ログインID） |
| password | VARCHAR | Not Null | ハッシュ化パスワード |
| total_points | INT | Default 0 | 累計獲得ポイント |

### 5.2 Study_Logs (学習記録テーブル)
| カラム名 | データ型 | 制約 | 説明 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PK, Auto Inc | ログID |
| user_id | BIGINT | FK | ユーザーID |
| study_date | DATE | Not Null | 学習日 |
| duration | INT | Not Null | 学習時間（分単位） |
| content | VARCHAR | | 学習内容メモ（例: Java Silver対策） |
| created_at | DATETIME | | 作成日時 |

### 5.3 Point_History (ポイント履歴テーブル・オプション)
※「なぜポイントが増えたか」を記録する場合に使用
| カラム名 | データ型 | 制約 | 説明 |
| :--- | :--- | :--- | :--- |
| id | BIGINT | PK, Auto Inc | ID |
| user_id | BIGINT | FK | ユーザーID |
| points | INT | Not Null | 付与ポイント数 |
| week_start_date| DATE | | 対象週の開始日 |
| rank_at_week | INT | | その週の順位 |

## 6. 非機能要件
- **レスポンス:** DB集計が発生するため、ランキング表示等のSQLクエリはインデックスを適切に貼るなど考慮する。
- **正確性:** 日付の扱いは `LocalDate` を使用し、タイムゾーン（JST）を統一する。
- **拡張性:** 将来的には「累計学習時間ランキング」や「科目別グラフ」などを追加できるように設計する。

***

### 開発のアドバイス（Spring Boot実装に向けて）

1.  **時間の集計ロジック:**
    SQLの `SUM` 関数と `BETWEEN` 句を使うのが最も効率的です。
    `SELECT SUM(duration) FROM study_logs WHERE user_id = ? AND study_date BETWEEN ? AND ?`
    というリポジトリメソッドを作成することになります。
2.  **ランキング処理:**
    全ユーザーの期間内合計時間を計算するのは負荷がかかる可能性があるため、学習規模であればSQLの `GROUP BY` と `ORDER BY` 一発で取得するのが楽です。
3.  **ポイント付与のバッチ処理:**
    Spring Bootの `@EnableScheduling` と `@Scheduled(cron = "0 0 0 * * MON")` （毎週月曜0時に実行）のアノテーションを使う絶好の機会です。

この要件定義書をベースに、まずは「記録して表示するだけ」のMVP（Minimum Viable Product）から作り始めるとスムーズかと思います。