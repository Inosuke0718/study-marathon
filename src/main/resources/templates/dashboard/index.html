<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
</head>
<body>

<div layout:fragment="content">
    
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-end mb-4 gap-3">
        <div>
            <h1 class="display-4 fw-black ls-tight mb-0" style="font-weight: 900;">DASHBOARD</h1>
            <p class="text-muted fw-bold mb-0">Keep pushing your limits.</p>
        </div>
    </div>

    <div class="row g-4">
        
        <!-- Left Column: Main Stats & Input -->
        <div class="col-lg-8 d-flex flex-column gap-4">
            
            <!-- Weekly Progress Section -->
            <section class="card p-4 position-relative overflow-hidden">
                <div class="position-absolute top-0 end-0 bg-retro-orange text-white fw-bold px-3 py-1 border-start border-bottom border-dark small">
                    WEEKLY GOAL
                </div>
                
                <h2 class="h4 fw-bold mb-4 d-flex align-items-center gap-2">
                    <i class="bi bi-calendar-week fs-3"></i>
                    THIS WEEK
                </h2>

                <div th:if="${weeklyTotalMinutes == 0}" class="text-muted fst-italic border border-dashed border-secondary p-4 text-center bg-light">
                    No study records yet. Start now!
                </div>
                
                <div th:if="${weeklyTotalMinutes > 0}">
                    <div class="d-flex align-items-baseline gap-2 mb-2">
                        <span class="display-3 fw-black text-retro-blue lh-1" th:text="${weeklyTotalHours}">0</span>
                        <span class="h5 fw-bold mb-0">hours</span>
                        <span class="display-3 fw-black text-retro-blue ms-3 lh-1" th:text="${weeklyTotalRemainMinutes}">0</span>
                        <span class="h5 fw-bold mb-0">mins</span>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="progress border border-dark rounded-0" style="height: 30px;">
                        <div class="progress-bar bg-retro-orange border-end border-dark" role="progressbar"
                             th:style="'width: ' + ${weeklyTotalMinutes > 600 ? 100 : (weeklyTotalMinutes * 100 / 600)} + '%'"
                             aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                             <div class="w-100 h-100 opacity-25" style="background-image: linear-gradient(45deg,rgba(0,0,0,.15) 25%,transparent 25%,transparent 50%,rgba(0,0,0,.15) 50%,rgba(0,0,0,.15) 75%,transparent 75%,transparent); background-size: 1rem 1rem;"></div>
                        </div>
                    </div>
                    <p class="text-end small fw-bold mt-1 text-muted">Target: 10 hours / week</p>
                </div>
            </section>

            <!-- Input Section -->
            <section class="card bg-retro-blue text-white p-4 shadow-retro border-dark">
                <h2 class="h4 fw-bold mb-4 border-bottom border-white pb-2" style="border-color: rgba(255,255,255,0.2) !important;">
                    LOG ACTIVITY
                </h2>
                
                <form th:action="@{/dashboard/logs}" th:object="${studyLogForm}" method="post" class="d-flex flex-column gap-3">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label fw-bold small">DATE</label>
                            <input type="date" th:field="*{studyDate}" 
                                   class="form-control fw-bold rounded-0 border-0 shadow-none">
                            <div th:if="${#fields.hasErrors('studyDate')}" th:errors="*{studyDate}" class="badge bg-retro-orange mt-1 rounded-0 border border-white text-wrap"></div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold small">DURATION (MIN)</label>
                            <input type="number" th:field="*{duration}" placeholder="60"
                                   class="form-control fw-bold rounded-0 border-0 shadow-none">
                            <div th:if="${#fields.hasErrors('duration')}" th:errors="*{duration}" class="badge bg-retro-orange mt-1 rounded-0 border border-white text-wrap"></div>
                        </div>
                    </div>
                    <div>
                        <label class="form-label fw-bold small">CONTENT</label>
                        <input type="text" th:field="*{content}" placeholder="What did you learn today?"
                               class="form-control fw-bold rounded-0 border-0 shadow-none">
                        <div th:if="${#fields.hasErrors('content')}" th:errors="*{content}" class="badge bg-retro-orange mt-1 rounded-0 border border-white text-wrap"></div>
                    </div>
                    
                    <div class="pt-2 text-end">
                        <button type="submit" class="btn btn-light text-retro-blue fw-bold px-4 py-2 rounded-0 border-0 shadow-sm">
                            RECORD LOG
                        </button>
                    </div>
                </form>
            </section>
            
            <!-- Recent Logs Table -->
            <section class="card p-4">
                <h2 class="h5 fw-black mb-4 text-uppercase">Recent Activities</h2>
                
                <div class="table-responsive">
                    <table class="table table-bordered border-dark table-hover mb-0 align-middle">
                        <thead class="table-light">
                        <tr>
                            <th class="fw-black" style="width: 60px;">ID</th>
                            <th class="fw-black" style="width: 120px;">DATE</th>
                            <th class="fw-black" style="width: 100px;">TIME</th>
                            <th class="fw-black">CONTENT</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="log : ${logs}">
                            <td class="font-monospace small" th:text="${log.id}"></td>
                            <td class="fw-bold" th:text="${log.studyDate}"></td>
                            <td>
                                <span class="badge bg-dark rounded-0" th:text="${log.duration} + ' min'"></span>
                            </td>
                            <td th:text="${log.content}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Right Column: Ranking -->
        <div class="col-lg-4">
            <section class="card bg-warning border-dark p-4 sticky-top" style="top: 100px;">
                <div class="d-flex align-items-center gap-2 mb-4 border-bottom border-dark pb-3">
                    <span class="display-6">ðŸ‘‘</span>
                    <h2 class="h4 fw-black mb-0">RANKING</h2>
                </div>

                <p th:if="${#lists.isEmpty(weeklyRanking)}" class="text-center fw-bold py-4">No data available.</p>

                <div th:if="${!#lists.isEmpty(weeklyRanking)}" class="d-flex flex-column gap-3">
                    <div th:each="rank, stat : ${weeklyRanking}" 
                         class="d-flex align-items-center bg-white border border-dark p-2 shadow-sm">
                        
                        <div class="d-flex align-items-center justify-content-center fw-black border border-dark me-3"
                             style="width: 40px; height: 40px;"
                             th:classappend="${stat.index == 0 ? 'bg-retro-orange text-white' : (stat.index == 1 ? 'bg-secondary text-white' : (stat.index == 2 ? 'bg-retro-cream' : 'bg-light'))}"
                             th:text="${stat.index + 1}">
                            1
                        </div>
                        
                        <div class="flex-grow-1 overflow-hidden">
                            <div class="fw-bold text-truncate" th:text="${rank.username}">User</div>
                            <div class="small text-muted font-monospace">
                                <span th:text="${rank.totalMinutes / 60}"></span>h
                                <span th:text="${rank.totalMinutes % 60}"></span>m
                            </div>
                        </div>
                        
                        <div th:if="${stat.index == 0}" class="fs-4">ðŸ”¥</div>
                    </div>
                </div>
                
                <div class="mt-4 p-3 bg-white border border-dark text-center">
                    <p class="fw-black small mb-1">MOTIVATION</p>
                    <p class="fst-italic small mb-0">"Consistency is the key to success."</p>
                </div>
            </section>
        </div>
        
    </div>

</div>

</body>
</html>
